<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.useso.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="逆向,反汇编,C++," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="最近闲了下来，总结一下之前的知识，这些东西都是好久之前留下的了，现在在回味一遍，梳理梳理。
逆向笔记之数组和指针的寻址。">
<meta property="og:type" content="article">
<meta property="og:title" content="逆向笔记（五）">
<meta property="og:url" content="http://blog.injectxx.com/2016/11/23/逆向笔记（五）/index.html">
<meta property="og:site_name" content="岁月's Blog">
<meta property="og:description" content="最近闲了下来，总结一下之前的知识，这些东西都是好久之前留下的了，现在在回味一遍，梳理梳理。
逆向笔记之数组和指针的寻址。">
<meta property="og:updated_time" content="2016-11-24T13:18:56.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="逆向笔记（五）">
<meta name="twitter:description" content="最近闲了下来，总结一下之前的知识，这些东西都是好久之前留下的了，现在在回味一遍，梳理梳理。
逆向笔记之数组和指针的寻址。">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>




  <link rel="canonical" href="http://blog.injectxx.com/2016/11/23/逆向笔记（五）/"/>

  <title> 逆向笔记（五） | 岁月's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?b1d70a29b3f59b8638bc9305a50cc2f6";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>






  <div style="display: none;">
    <script src="//s6.cnzz.com/stat.php?id=1260188451&web_id=1260188451" type="text/javascript"></script>
  </div>





  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">岁月's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">一只奋斗的猿</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-board">
          <a href="/board" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />
            
            留言板
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-neighbor">
          <a href="/neighbor" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heart"></i> <br />
            
            邻居
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                逆向笔记（五）
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-23T16:12:54+08:00" content="2016-11-23">
              2016-11-23
            </time>
          </span>


          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/11/23/逆向笔记（五）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/23/逆向笔记（五）/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
              &nbsp; | &nbsp;
              <span class="page-pv"><i class="fa fa-file-o"></i>
              <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
              </span>
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>最近闲了下来，总结一下之前的知识，这些东西都是好久之前留下的了，现在在回味一遍，梳理梳理。</p>
<p>逆向笔记之数组和指针的寻址。<br><a id="more"></a></p>
<p>数组和指针的寻址</p>
<h2 id="数组在函数内"><a href="#数组在函数内" class="headerlink" title="数组在函数内"></a>数组在函数内</h2><p>当在函数内定义数组时，如果无其他声明，该数组即为局部变量，拥有局部变量的所有特性。数组中的数据在内存中的存储是线性连续的，其数据排列顺序由低地址到高地址，数组名表示数组首地址，如int nArr[5] = {1,2,3,4,5};此数组为5个int类型数据的集合，其占用的内存大小为sizeof(数据类型)<em>数组元素个数，也就是4</em>5 = 20字节。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">C代码</div><div class="line">int _tmain(int argc, _TCHAR* argv[])</div><div class="line">&#123;</div><div class="line">    int nArr[5] = &#123; 1, 2, 3, 4, 5 &#125;;</div><div class="line">    int n1 = 1;</div><div class="line">    int n2 = 2;</div><div class="line">    int n3 = 3;</div><div class="line">    int n4 = 4;</div><div class="line">    int n5 = 5;</div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line">对应反汇编Debug：</div><div class="line">·00A63CB0 &gt;  55              push ebp</div><div class="line">00A63CB1    8BEC            mov ebp,esp</div><div class="line">00A63CB3    81EC 18010000   sub esp,0x118</div><div class="line">00A63CB9    53              push ebx</div><div class="line">00A63CBA    56              push esi</div><div class="line">00A63CBB    57              push edi</div><div class="line">00A63CBC    8DBD E8FEFFFF   lea edi,dword ptr ss:[ebp-0x118]</div><div class="line">00A63CC2    B9 46000000     mov ecx,0x46</div><div class="line">00A63CC7    B8 CCCCCCCC     mov eax,0xCCCCCCCC</div><div class="line">00A63CCC    F3:AB           rep stos dword ptr es:[edi]</div><div class="line">00A63CCE    C745 E8 0100000&gt;mov dword ptr ss:[ebp-0x18],0x1</div><div class="line">00A63CD5    C745 EC 0200000&gt;mov dword ptr ss:[ebp-0x14],0x2</div><div class="line">00A63CDC    C745 F0 0300000&gt;mov dword ptr ss:[ebp-0x10],0x3</div><div class="line">00A63CE3    C745 F4 0400000&gt;mov dword ptr ss:[ebp-0xC],0x4</div><div class="line">00A63CEA    C745 F8 0500000&gt;mov dword ptr ss:[ebp-0x8],0x5 //初始化数组</div><div class="line">00A63CF1    C745 DC 0100000&gt;mov dword ptr ss:[ebp-0x24],0x1 //初始化局部变量</div><div class="line">00A63CF8    C745 D0 0200000&gt;mov dword ptr ss:[ebp-0x30],0x2</div><div class="line">00A63CFF    C745 C4 0300000&gt;mov dword ptr ss:[ebp-0x3C],0x3</div><div class="line">00A63D06    C745 B8 0400000&gt;mov dword ptr ss:[ebp-0x48],0x4</div><div class="line">00A63D0D    C745 AC 0500000&gt;mov dword ptr ss:[ebp-0x54],0x5</div><div class="line">00A63D14    33C0            xor eax,eax</div><div class="line">00A63D16    52              push edx</div><div class="line">00A63D17    8BCD            mov ecx,ebp</div><div class="line">00A63D19    50              push eax</div><div class="line">00A63D1A    8D15 303DA600   lea edx,dword ptr ds:[0xA63D30]</div><div class="line">00A63D20    E8 A7D4FFFF     call TestCode.00A611CC</div><div class="line">00A63D25    58              pop eax</div><div class="line">00A63D26    5A              pop edx</div><div class="line">00A63D27    5F              pop edi</div><div class="line">00A63D28    5E              pop esi</div><div class="line">00A63D29    5B              pop ebx</div><div class="line">00A63D2A    8BE5            mov esp,ebp</div><div class="line">00A63D2C    5D              pop ebp</div><div class="line">00A63D2D    C3              retn</div><div class="line">对于数组的识别，应判断数据在内存中是否是连续且类型是否一致，均符合即可将此段数据视为数组。</div><div class="line">Ida对数组的识别（ida下的标号var_18为常量-18，这里地址值最小，因此为数据的首地址，双击标号“var_18”定位到标号定义处，单击此标号，按*键，以标号“var_18”所标示的地址为数组首地址，每个元素4字节大小向后解释五个数据作为数组元素）：</div><div class="line"></div><div class="line"></div><div class="line">现在再来看一下字符串，其实字符串就是字符数组，只是最后一个元素为‘\0’作为字符串结束标志而已。书上说在Vc++6.0编译器下，为字符类型的数组赋值（初始化）其实是复制字符串的过程。</div><div class="line">这里并不是单字节复制，而是每次复制4字节的数据。</div><div class="line">C代码：</div><div class="line">Char szBuf = “Hello World”;</div><div class="line">对应反汇编Debug：</div><div class="line">01173D14    A1 A8581701     mov eax,dword ptr ds:[0x11758A8]</div><div class="line">01173D19    8945 98         mov dword ptr ss:[ebp-0x68],eax</div><div class="line">01173D1C    8B0D AC581701   mov ecx,dword ptr ds:[0x11758AC]</div><div class="line">01173D22    894D 9C         mov dword ptr ss:[ebp-0x64],ecx</div><div class="line">01173D25    8B15 B0581701   mov edx,dword ptr ds:[0x11758B0]</div><div class="line">01173D2B    8955 A0         mov dword ptr ss:[ebp-0x60],edx</div><div class="line">由此可以看出，这里使用了eax，ecx，edx三个寄存器，将字符串分为三段每次四字节复制到szBuf中。这里字符串长度恰巧为4的倍数。当长度不为4的倍数时候，会在最后一次不等于4字节的数据过程中按照或者2字节的方式复制。</div><div class="line">C代码：</div><div class="line">Char szBuf = “Hello World 12”; //长度不为4的倍数</div><div class="line">对应反汇编Debug：</div><div class="line">003D3D14    A1 A8583D00     mov eax,dword ptr ds:[0x3D58A8]</div><div class="line">003D3D19    8945 94         mov dword ptr ss:[ebp-0x6C],eax</div><div class="line">003D3D1C    8B0D AC583D00   mov ecx,dword ptr ds:[0x3D58AC]</div><div class="line">003D3D22    894D 98         mov dword ptr ss:[ebp-0x68],ecx</div><div class="line">003D3D25    8B15 B0583D00   mov edx,dword ptr ds:[0x3D58B0]</div><div class="line">003D3D2B    8955 9C         mov dword ptr ss:[ebp-0x64],edx</div><div class="line">003D3D2E    66:A1 B4583D00  mov ax,word ptr ds:[0x3D58B4]</div><div class="line">003D3D34    66:8945 A0      mov word ptr ss:[ebp-0x60],ax</div><div class="line">003D3D38    8A0D B6583D00   mov cl,byte ptr ds:[0x3D58B6]</div><div class="line">003D3D3E    884D A2         mov byte ptr ss:[ebp-0x5E],cl</div></pre></td></tr></table></figure>
<p>由此可以看出前面的复制过程没有改变，最后的三字节先复制两字节，最后复制一字节。</p>
<h2 id="数组作为参数"><a href="#数组作为参数" class="headerlink" title="数组作为参数"></a>数组作为参数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">C代码：</div><div class="line">void Show(char szBuf[])</div><div class="line">&#123;</div><div class="line">    strcpy(szBuf,&quot;Hello World&quot;);</div><div class="line">    printf(szBuf);</div><div class="line">&#125;</div><div class="line">int _tmain(int argc, _TCHAR* argv[])</div><div class="line">&#123;</div><div class="line">    char szBuf[20] = &#123; 0 &#125;;</div><div class="line">    Show(szBuf);</div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line">对应反汇编Debug：</div><div class="line">Main函数</div><div class="line">00EC33F0 &gt;  55              push ebp</div><div class="line">00EC33F1    8BEC            mov ebp,esp</div><div class="line">00EC33F3    81EC E0000000   sub esp,0xE0</div><div class="line">00EC33F9    53              push ebx</div><div class="line">00EC33FA    56              push esi</div><div class="line">00EC33FB    57              push edi</div><div class="line">00EC33FC    8DBD 20FFFFFF   lea edi,dword ptr ss:[ebp-0xE0]</div><div class="line">00EC3402    B9 38000000     mov ecx,0x38</div><div class="line">00EC3407    B8 CCCCCCCC     mov eax,0xCCCCCCCC</div><div class="line">00EC340C    F3:AB           rep stos dword ptr es:[edi]</div><div class="line">00EC340E    A1 0C80EC00     mov eax,dword ptr ds:[__security_cookie]</div><div class="line">00EC3413    33C5            xor eax,ebp</div><div class="line">00EC3415    8945 FC         mov dword ptr ss:[ebp-0x4],eax</div><div class="line">00EC3418    C645 E4 00      mov byte ptr ss:[ebp-0x1C],0x0 //初始化数组，ebp-0x1c为数组首地址</div><div class="line">00EC341C    33C0            xor eax,eax</div><div class="line">00EC341E    8945 E5         mov dword ptr ss:[ebp-0x1B],eax</div><div class="line">00EC3421    8945 E9         mov dword ptr ss:[ebp-0x17],eax</div><div class="line">00EC3424    8945 ED         mov dword ptr ss:[ebp-0x13],eax</div><div class="line">00EC3427    8945 F1         mov dword ptr ss:[ebp-0xF],eax</div><div class="line">00EC342A    66:8945 F5      mov word ptr ss:[ebp-0xB],ax</div><div class="line">00EC342E    8845 F7         mov byte ptr ss:[ebp-0x9],al</div><div class="line">00EC3431    8D45 E4         lea eax,dword ptr ss:[ebp-0x1C] //取地址</div><div class="line">00EC3434    50              push eax //参数入栈</div><div class="line">00EC3435    E8 00DEFFFF     call TestCode.00EC123A //调用Show函数</div><div class="line">00EC343A    83C4 04         add esp,0x4 //平衡堆栈</div><div class="line">00EC343D    33C0            xor eax,eax</div><div class="line">00EC343F    52              push edx</div><div class="line">00EC3440    8BCD            mov ecx,ebp</div><div class="line">00EC3442    50              push eax</div><div class="line">00EC3443    8D15 7034EC00   lea edx,dword ptr ds:[0xEC3470]</div><div class="line">00EC3449    E8 7EDDFFFF     call TestCode.00EC11CC</div><div class="line">00EC344E    58              pop eax</div><div class="line">00EC344F    5A              pop edx</div><div class="line">00EC3450    5F              pop edi</div><div class="line">00EC3451    5E              pop esi</div><div class="line">00EC3452    5B              pop ebx</div><div class="line">00EC3453    8B4D FC         mov ecx,dword ptr ss:[ebp-0x4]</div><div class="line">00EC3456    33CD            xor ecx,ebp</div><div class="line">00EC3458    E8 C1DBFFFF     call TestCode.00EC101E</div><div class="line">00EC345D    81C4 E0000000   add esp,0xE0</div><div class="line">00EC3463    3BEC            cmp ebp,esp</div><div class="line">00EC3465    E8 71DDFFFF     call TestCode.00EC11DB</div><div class="line">00EC346A    8BE5            mov esp,ebp</div><div class="line">00EC346C    5D              pop ebp</div><div class="line">00EC346D    C3              retn</div><div class="line"></div><div class="line">Show函数</div><div class="line">00EC3CB0 &gt;  55              push ebp</div><div class="line">00EC3CB1    8BEC            mov ebp,esp</div><div class="line">00EC3CB3    81EC C0000000   sub esp,0xC0</div><div class="line">00EC3CB9    53              push ebx</div><div class="line">00EC3CBA    56              push esi</div><div class="line">00EC3CBB    57              push edi</div><div class="line">00EC3CBC    8DBD 40FFFFFF   lea edi,dword ptr ss:[ebp-0xC0]</div><div class="line">00EC3CC2    B9 30000000     mov ecx,0x30</div><div class="line">00EC3CC7    B8 CCCCCCCC     mov eax,0xCCCCCCCC</div><div class="line">00EC3CCC    F3:AB           rep stos dword ptr es:[edi]</div><div class="line">00EC3CCE    68 A858EC00     push TestCode.00EC58A8                   ; ASCII &quot;Hello World&quot; //压入字符串</div><div class="line">00EC3CD3    8B45 08         mov eax,dword ptr ss:[ebp+0x8] //参数1给eax</div><div class="line">00EC3CD6    50              push eax //参数1入栈</div><div class="line">00EC3CD7    E8 68D5FFFF     call TestCode.00EC1244 //调用strcpy函数</div><div class="line">00EC3CDC    83C4 08         add esp,0x8 //平衡堆栈</div><div class="line">00EC3CDF    8BF4            mov esi,esp</div><div class="line">00EC3CE1    8B45 08         mov eax,dword ptr ss:[ebp+0x8]</div><div class="line">00EC3CE4    50              push eax </div><div class="line">00EC3CE5    FF15 1491EC00   call dword ptr ds:[&lt;&amp;MSVCR120D.printf&gt;]  ; MSVCR120.printf</div><div class="line">00EC3CEB    83C4 04         add esp,0x4</div><div class="line">00EC3CEE    3BF4            cmp esi,esp</div><div class="line">00EC3CF0    E8 E6D4FFFF     call TestCode.00EC11DB</div><div class="line">00EC3CF5    5F              pop edi</div><div class="line">00EC3CF6    5E              pop esi</div><div class="line">00EC3CF7    5B              pop ebx</div><div class="line">00EC3CF8    81C4 C0000000   add esp,0xC0</div><div class="line">00EC3CFE    3BEC            cmp ebp,esp</div><div class="line">00EC3D00    E8 D6D4FFFF     call TestCode.00EC11DB</div><div class="line">00EC3D05    8BE5            mov esp,ebp</div><div class="line">00EC3D07    5D              pop ebp</div><div class="line">00EC3D08    C3              retn</div></pre></td></tr></table></figure>
<p>从这里可以看出，当数组作为参数时，数组下标被省略了。因为当数组作为函数参数时，函数参数中保存的是数组的首地址，是一个指针变量。虽然是指针变量，但需要特别注意的是，实参数组名为常量值，而指针或形参数组为变量。使用sizeof(数组名)可以获取数组的总大小，而对指针或者形参中保存的数组名使用sizeof只能得到指针长度。</p>
<p>再来看看Release下的字符串处理函数<br>这里我用的编译器是vs2013</p>
<p>代码都优化掉了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">Vc6编译后的反汇编Release：</div><div class="line">text:00401000 sub_401000      proc near               ; CODE XREF: _main+Fp</div><div class="line">.text:00401000</div><div class="line">.text:00401000 arg_0           = dword ptr  4</div><div class="line">.text:00401000</div><div class="line">.text:00401000                 push    edi</div><div class="line">.text:00401001                 mov     edi, [esp+4+arg_0] //把字符串首地址给edi </div><div class="line">.text:00401005                 or      ecx, 0FFFFFFFFh //ecx置为-1配合使用  repne scasb指令</div><div class="line">.text:00401008                 xor     eax, eax //清零eax</div><div class="line">.text:0040100A                 repne scasb</div><div class="line">//repne/repnz与scas指令结合使用，表示串未结束（ecx!=0）</div><div class="line">//当eax与串元素不相同（zf = 0）时，继续重复执行串搜索指令</div><div class="line">//可用来在字符串中查找和eax值相同的数据位置</div><div class="line">.text:0040100C                 not     ecx //对ecx取反</div><div class="line">.text:0040100E                 dec     ecx //对取反后的值-1得到字符串长度</div><div class="line">.text:0040100F                 pop     edi</div><div class="line">.text:00401010                 mov     eax, ecx</div><div class="line">.text:00401012                 retn</div><div class="line">.text:00401012 sub_401000      endp</div></pre></td></tr></table></figure></p>
<p>优化后的strlen函数被编译为内联函数，其实现过程为，先将eax清零，然后通过repne scasb指令遍历字符串，寻找与eax匹配的字符。由于指令repne scasb中的前缀repne是用来考察ecx的值，因此在ecx不为0且zf标志为0时才重复操作，在操作过程中自动对ecx减一。可见不适合将ecx作为从0开始的字符计数器。由于目标字符串的长度未知，所以置为-1，可满足最大需求。<br>统计完成后可根据ecx的值推算出字符串长度，推算过程如下：<br>Ecx的初始值为0xffffffff（-1），repne前缀每次执行时-1，如果edi指向内容为字符串结束符，则结束操作。注意，ecx的计数包含了字符串末尾的0.假设字符串长度为Len，可得到等式<br>Ecx（终值） = Ecx（初值） - （Len + 1）<br>将Ecx初值-1带入得<br>Ecx（终值） = -1 - （Len + 1） = -（Len + 2）<br>定义neg为求补运算，则<br>Neg（Ecx（终值）） = Len + 2<br>求补运算等价于取反加一，定义not为取反运算，则<br>Neg（Ecx（终值）） + 1 = Len + 2<br>解方程求Len<br>Len = not（Ecx（终值）） - 1<br>至此对strlen的分析完毕。</p>
<h2 id="Strcpy分析"><a href="#Strcpy分析" class="headerlink" title="Strcpy分析"></a>Strcpy分析</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">Vc6编译后的反汇编Release：</div><div class="line">.text:00401000 sub_401000      proc near               ; CODE XREF: _main+32p</div><div class="line">.text:00401000</div><div class="line">.text:00401000 arg_0           = dword ptr  4</div><div class="line">.text:00401000</div><div class="line">.text:00401000                 push    esi</div><div class="line">.text:00401001                 push    edi</div><div class="line">.text:00401002                 mov     edi, offset aHello ; &quot;Hello&quot; //把字符串给edi</div><div class="line">.text:00401007                 or      ecx, 0FFFFFFFFh //ecx置为-1</div><div class="line">.text:0040100A                 xor     eax, eax //清零eax</div><div class="line">.text:0040100C                 repne scasb</div><div class="line">.text:0040100E                 mov     eax, [esp+8+arg_0] //字符串首地址给eax</div><div class="line">.text:00401012                 not     ecx //对ecx取反，得到字符串长度</div><div class="line">.text:00401014                 sub     edi, ecx //执行repne scasb指令后edi指向字符串末尾，减去ecx重新指向字符串首地址</div><div class="line">.text:00401016                 push    eax             ; char * //参数入栈</div><div class="line">.text:00401017                 mov     edx, ecx //把字符串长度给edx</div><div class="line">.text:00401019                 mov     esi, edi //把字符串首地址给esi</div><div class="line">.text:0040101B                 mov     edi, eax //参数给edi</div><div class="line">.text:0040101D                 shr     ecx, 2 //右移两位相当于/4</div><div class="line">.text:00401020                 rep movsd //拷贝字符串，每次复制4字节，根据ecx数值决定复制多少次</div><div class="line">.text:00401022                 mov     ecx, edx //把字符串长度给ecx</div><div class="line">.text:00401024                 and     ecx, 3 //ecx与3进行与运算，等价于ecx对4求余</div><div class="line">.text:00401027                 rep movsb //拷贝字符串，单字节拷贝</div><div class="line">.text:00401029                 call    _printf</div><div class="line">.text:0040102E                 add     esp, 4</div><div class="line">.text:00401031                 pop     edi</div><div class="line">.text:00401032                 pop     esi</div><div class="line">.text:00401033                 retn</div><div class="line">.text:00401033 sub_401000      endp</div></pre></td></tr></table></figure>
<h2 id="局部数组作为返回值"><a href="#局部数组作为返回值" class="headerlink" title="局部数组作为返回值"></a>局部数组作为返回值</h2><p>局部变量可以作为返回值，这是因为局部变量虽然也在函数的栈中，但是他会在函数结束之前将值存入某个寄存器中（一般是eax与edx），但是局部数组作为返回值往往只会将他的首地址存入某个寄存器，这样一来当寄存器存储的地址内的区域里面的内容发生改变时便会造成原数据的改变。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">C代码：</div><div class="line">char *RetArr()</div><div class="line">&#123;</div><div class="line">    char szBuf[] = &#123; &quot;Hello World&quot; &#125;;</div><div class="line">    return szBuf;</div><div class="line">&#125;</div><div class="line"></div><div class="line">int _tmain(int argc, _TCHAR* argv[])</div><div class="line">&#123;</div><div class="line">    printf(&quot;%s&quot;, RetArr());</div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line">对应反汇编Debug：</div><div class="line">Main函数</div><div class="line">00871790 &gt;  55              push ebp</div><div class="line">00871791    8BEC            mov ebp,esp</div><div class="line">00871793    81EC C0000000   sub esp,0xC0</div><div class="line">00871799    53              push ebx</div><div class="line">0087179A    56              push esi</div><div class="line">0087179B    57              push edi</div><div class="line">0087179C    8DBD 40FFFFFF   lea edi,dword ptr ss:[ebp-0xC0]</div><div class="line">008717A2    B9 30000000     mov ecx,0x30</div><div class="line">008717A7    B8 CCCCCCCC     mov eax,0xCCCCCCCC</div><div class="line">008717AC    F3:AB           rep stos dword ptr es:[edi]</div><div class="line">008717AE    E8 9BFAFFFF     call TestCode.0087124E //调用RetArr函数</div><div class="line">008717B3    8BF4            mov esi,esp</div><div class="line">008717B5    50              push eax</div><div class="line">008717B6    68 B4588700     push TestCode.008758B4                   ; ASCII &quot;%s&quot;</div><div class="line">008717BB    FF15 14918700   call dword ptr ds:[&lt;&amp;MSVCR120D.printf&gt;]  ; MSVCR120.printf</div><div class="line">008717C1    83C4 08         add esp,0x8</div><div class="line">008717C4    3BF4            cmp esi,esp</div><div class="line">008717C6    E8 10FAFFFF     call TestCode.008711DB</div><div class="line">008717CB    33C0            xor eax,eax</div><div class="line">008717CD    5F              pop edi</div><div class="line">008717CE    5E              pop esi</div><div class="line">008717CF    5B              pop ebx</div><div class="line">008717D0    81C4 C0000000   add esp,0xC0</div><div class="line">008717D6    3BEC            cmp ebp,esp</div><div class="line">008717D8    E8 FEF9FFFF     call TestCode.008711DB</div><div class="line">008717DD    8BE5            mov esp,ebp</div><div class="line">008717DF    5D              pop ebp</div><div class="line">008717E0    C3              retn</div><div class="line"></div><div class="line">RetArr函数</div><div class="line">008733F0 &gt;  55              push ebp</div><div class="line">008733F1    8BEC            mov ebp,esp</div><div class="line">008733F3    81EC D8000000   sub esp,0xD8</div><div class="line">008733F9    53              push ebx</div><div class="line">008733FA    56              push esi</div><div class="line">008733FB    57              push edi</div><div class="line">008733FC    8DBD 28FFFFFF   lea edi,dword ptr ss:[ebp-0xD8]</div><div class="line">00873402    B9 36000000     mov ecx,0x36</div><div class="line">00873407    B8 CCCCCCCC     mov eax,0xCCCCCCCC</div><div class="line">0087340C    F3:AB           rep stos dword ptr es:[edi]</div><div class="line">0087340E    A1 0C808700     mov eax,dword ptr ds:[__security_cookie]</div><div class="line">00873413    33C5            xor eax,ebp</div><div class="line">00873415    8945 FC         mov dword ptr ss:[ebp-0x4],eax</div><div class="line">00873418    A1 A8588700     mov eax,dword ptr ds:[0x8758A8] </div><div class="line">0087341D    8945 EC         mov dword ptr ss:[ebp-0x14],eax </div><div class="line">00873420    8B0D AC588700   mov ecx,dword ptr ds:[0x8758AC]</div><div class="line">00873426    894D F0         mov dword ptr ss:[ebp-0x10],ecx</div><div class="line">00873429    8B15 B0588700   mov edx,dword ptr ds:[0x8758B0]</div><div class="line">0087342F    8955 F4         mov dword ptr ss:[ebp-0xC],edx</div><div class="line">00873432    8D45 EC         lea eax,dword ptr ss:[ebp-0x14] //将数组的首地址存入寄存器作为返回值</div><div class="line">00873435    52              push edx</div><div class="line">00873436    8BCD            mov ecx,ebp</div><div class="line">00873438    50              push eax</div><div class="line">00873439    8D15 58348700   lea edx,dword ptr ds:[0x873458]</div><div class="line">0087343F    E8 88DDFFFF     call TestCode.008711CC</div><div class="line">00873444    58              pop eax</div><div class="line">00873445    5A              pop edx</div><div class="line">00873446    5F              pop edi</div><div class="line">00873447    5E              pop esi</div><div class="line">00873448    5B              pop ebx</div><div class="line">00873449    8B4D FC         mov ecx,dword ptr ss:[ebp-0x4]</div><div class="line">0087344C    33CD            xor ecx,ebp</div><div class="line">0087344E    E8 CBDBFFFF     call TestCode.0087101E</div><div class="line">00873453    8BE5            mov esp,ebp</div><div class="line">00873455    5D              pop ebp</div><div class="line">00873456    C3              retn</div></pre></td></tr></table></figure>
<p>由此来看好像并不会出现什么问题，在调用printf函数之前将eax的值作为参数入栈，然后将其所在的内存空间中的内容以字符串的形式输出。eax是安全的，但是以eax的值作为地址的内存空间并不安全。<br>如果想使用数组作为返回值，又想避免如上错误，可以使用全局数组，静态数组或是上层调用函数中定义的局部数组。</p>
<p>全局数组与静态数组都属于变量，他们的特征与全局变量，静态变量相同，看上去就是连续定义的多个同类型变量。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">C代码：</div><div class="line">int g_nArry[5] = &#123; 1, 2, 3, 4, 5 &#125;;</div><div class="line">int _tmain(int argc, _TCHAR* argv[])</div><div class="line">&#123;</div><div class="line">    for (int i = 0; i &lt; 5; i++)</div><div class="line">    &#123;</div><div class="line">        printf(&quot;%d&quot;, g_nArry[i]);</div><div class="line">    &#125;</div><div class="line">    //printf(&quot;%s&quot;, RetArr());</div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line">对应反汇编Debug：</div><div class="line">.text:00412FA0 ; int __cdecl main(int argc, const char **argv, const char **envp)</div><div class="line">.text:00412FA0 main            proc near               ; CODE XREF: j_mainj</div><div class="line">.text:00412FA0                                         ; .text:004111C2j</div><div class="line">.text:00412FA0</div><div class="line">.text:00412FA0 var_CC          = byte ptr -0CCh</div><div class="line">.text:00412FA0 var_8           = dword ptr -8</div><div class="line">.text:00412FA0 argc            = dword ptr  8</div><div class="line">.text:00412FA0 argv            = dword ptr  0Ch</div><div class="line">.text:00412FA0 envp            = dword ptr  10h</div><div class="line">.text:00412FA0</div><div class="line">.text:00412FA0                 push    ebp</div><div class="line">.text:00412FA1                 mov     ebp, esp</div><div class="line">.text:00412FA3                 sub     esp, 0CCh</div><div class="line">.text:00412FA9                 push    ebx</div><div class="line">.text:00412FAA                 push    esi</div><div class="line">.text:00412FAB                 push    edi</div><div class="line">.text:00412FAC                 lea     edi, [ebp+var_CC]</div><div class="line">.text:00412FB2                 mov     ecx, 33h</div><div class="line">.text:00412FB7                 mov     eax, 0CCCCCCCCh</div><div class="line">.text:00412FBC                 rep stosd</div><div class="line">.text:00412FBE                 mov     [ebp+var_8], 0 //i赋初值</div><div class="line">.text:00412FC5                 jmp     short loc_412FD0</div><div class="line">.text:00412FC7 ; ---------------------------------------------------------------------------</div><div class="line">.text:00412FC7</div><div class="line">.text:00412FC7 loc_412FC7:                             ; CODE XREF: main+58j</div><div class="line">.text:00412FC7                 mov     eax, [ebp+var_8] </div><div class="line">.text:00412FCA                 add     eax, 1 //i++</div><div class="line">.text:00412FCD                 mov     [ebp+var_8], eax</div><div class="line">.text:00412FD0</div><div class="line">.text:00412FD0 loc_412FD0:                             ; CODE XREF: main+25j</div><div class="line">.text:00412FD0                 cmp     [ebp+var_8], 5 //与5比较，循环最大值</div><div class="line">.text:00412FD4                 jge     short loc_412FFA //大于则跳出循环</div><div class="line">.text:00412FD6                 mov     esi, esp</div><div class="line">.text:00412FD8                 mov     eax, [ebp+var_8]</div><div class="line">.text:00412FDB                 mov     ecx, dword_418028[eax*4] //dword_418028为全局数组，利用下标寻址到相应数据</div><div class="line">.text:00412FE2                 push    ecx</div><div class="line">.text:00412FE3                 push    offset Format   ; &quot;%d&quot;</div><div class="line">.text:00412FE8                 call    ds:printf //调用printf</div><div class="line">.text:00412FEE                 add     esp, 8 //堆栈平衡</div><div class="line">.text:00412FF1                 cmp     esi, esp</div><div class="line">.text:00412FF3                 call    sub_4111DB</div><div class="line">.text:00412FF8                 jmp     short loc_412FC7</div><div class="line">.text:00412FFA ; ---------------------------------------------------------------------------</div><div class="line">.text:00412FFA</div><div class="line">.text:00412FFA loc_412FFA:                             ; CODE XREF: main+34j</div><div class="line">.text:00412FFA                 xor     eax, eax</div><div class="line">.text:00412FFC                 pop     edi</div><div class="line">.text:00412FFD                 pop     esi</div><div class="line">.text:00412FFE                 pop     ebx</div><div class="line">.text:00412FFF                 add     esp, 0CCh</div><div class="line">.text:00413005                 cmp     ebp, esp</div><div class="line">.text:00413007                 call    sub_4111DB</div><div class="line">.text:0041300C                 mov     esp, ebp</div><div class="line">.text:0041300E                 pop     ebp</div><div class="line">.text:0041300F                 retn</div><div class="line">.text:0041300F main            endp</div></pre></td></tr></table></figure>
<p>*键对数据进行编辑，</p>
<p>再来看看静态全局数组，静态数组在全局情况下和全局数组相同。作为局部作用域定义时，则同样会检查相应的标志位，并对局部静态数组元素赋值。与局部静态变量有些不同，无论局部静态数组有多少个元素，也只会检查一次初始化标志位。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">C代码：</div><div class="line">int _tmain(int argc, _TCHAR* argv[])</div><div class="line">&#123;</div><div class="line"></div><div class="line">    int n1;</div><div class="line">    int n2;</div><div class="line">    scanf(&quot;%d%d&quot;, &amp;n1, &amp;n2);</div><div class="line">    static int g_snArr[5] = &#123; n1, n2, 0 &#125;;</div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line">对应反汇编代码Debug：</div><div class="line">00913AC0 &gt;  55              push ebp</div><div class="line">00913AC1    8BEC            mov ebp,esp</div><div class="line">00913AC3    81EC D8000000   sub esp,0xD8</div><div class="line">00913AC9    53              push ebx</div><div class="line">00913ACA    56              push esi</div><div class="line">00913ACB    57              push edi</div><div class="line">00913ACC    8DBD 28FFFFFF   lea edi,dword ptr ss:[ebp-0xD8]</div><div class="line">00913AD2    B9 36000000     mov ecx,0x36</div><div class="line">00913AD7    B8 CCCCCCCC     mov eax,0xCCCCCCCC</div><div class="line">00913ADC    F3:AB           rep stos dword ptr es:[edi]</div><div class="line">00913ADE    8BF4            mov esi,esp</div><div class="line">00913AE0    8D45 EC         lea eax,dword ptr ss:[ebp-0x14] //n2</div><div class="line">00913AE3    50              push eax</div><div class="line">00913AE4    8D4D F8         lea ecx,dword ptr ss:[ebp-0x8] //n1</div><div class="line">00913AE7    51              push ecx</div><div class="line">00913AE8    68 18599100     push TestCode.00915918                   ; ASCII &quot;%d%d&quot;</div><div class="line">00913AED    FF15 3C919100   call dword ptr ds:[&lt;&amp;MSVCR120D.scanf&gt;]   ; MSVCR120.scanf //调用scanf</div><div class="line">00913AF3    83C4 0C         add esp,0xC //堆栈平衡</div><div class="line">00913AF6    3BF4            cmp esi,esp</div><div class="line">00913AF8    E8 DED6FFFF     call TestCode.009111DB</div><div class="line">00913AFD    A1 BC849100     mov eax,dword ptr ds:[$S1]</div><div class="line">00913B02    83E0 01         and eax,0x1 //检查标准位是否为1，初始化了则跳过下面代码</div><div class="line">00913B05    75 33           jnz short TestCode.00913B3A</div><div class="line">00913B07    A1 BC849100     mov eax,dword ptr ds:[$S1]</div><div class="line">00913B0C    83C8 01         or eax,0x1 //将标志位置为1</div><div class="line">00913B0F    A3 BC849100     mov dword ptr ds:[$S1],eax //写回标志位</div><div class="line">00913B14    8B45 F8         mov eax,dword ptr ss:[ebp-0x8]</div><div class="line">00913B17    A3 A8849100     mov dword ptr ds:[g_snArr],eax</div><div class="line">00913B1C    8B45 EC         mov eax,dword ptr ss:[ebp-0x14]</div><div class="line">00913B1F    A3 AC849100     mov dword ptr ds:[0x9184AC],eax</div><div class="line">00913B24    C705 B0849100 0&gt;mov dword ptr ds:[0x9184B0],0x0</div><div class="line">00913B2E    33C0            xor eax,eax</div><div class="line">00913B30    A3 B4849100     mov dword ptr ds:[0x9184B4],eax</div><div class="line">00913B35    A3 B8849100     mov dword ptr ds:[0x9184B8],eax</div><div class="line">00913B3A    33C0            xor eax,eax</div><div class="line">00913B3C    52              push edx</div><div class="line">00913B3D    8BCD            mov ecx,ebp</div><div class="line">00913B3F    50              push eax</div><div class="line">00913B40    8D15 643B9100   lea edx,dword ptr ds:[0x913B64]</div><div class="line">00913B46    E8 81D6FFFF     call TestCode.009111CC</div><div class="line">00913B4B    58              pop eax</div><div class="line">00913B4C    5A              pop edx</div><div class="line">00913B4D    5F              pop edi</div><div class="line">00913B4E    5E              pop esi</div><div class="line">00913B4F    5B              pop ebx</div><div class="line">00913B50    81C4 D8000000   add esp,0xD8</div><div class="line">00913B56    3BEC            cmp ebp,esp</div><div class="line">00913B58    E8 7ED6FFFF     call TestCode.009111DB</div><div class="line">00913B5D    8BE5            mov esp,ebp</div><div class="line">00913B5F    5D              pop ebp</div><div class="line">00913B60    C3              retn</div></pre></td></tr></table></figure>
<p>由此可以看出无论静态局部数组有多少个元素，都只进行一次初始化。</p>
<h2 id="下标寻址和指针寻址"><a href="#下标寻址和指针寻址" class="headerlink" title="下标寻址和指针寻址"></a>下标寻址和指针寻址</h2><p>访问数组的方法有两种：通过下标访问（寻址）和通过指针访问（寻址）。因为使用方便，通过下标访问的方式比较常用，其格式为“数组名[标号]”。指针寻址的方式不但没有下标寻址的方式便利，而且效率也比下标寻址低。由于指针是存放地址数据的变量类型，因此在数据访问的过程中需要先取出指针变量中的数据，然后在针对此数据进行地址偏移计算，从而寻址到目标数据。数组名本身就是常量地址，可直接针对数组名所代替的地址值进行偏移计算。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">C代码：</div><div class="line">int _tmain(int argc, _TCHAR* argv[])</div><div class="line">&#123;</div><div class="line">    char *pChar = NULL;</div><div class="line">    char szBuf[] = &quot;Hello&quot;;</div><div class="line">    pChar = szBuf;</div><div class="line">    printf(&quot;%c\n&quot;, *pChar);</div><div class="line">    printf(&quot;%c\n&quot;, szBuf[0]);</div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line">对应反汇编Debug：</div><div class="line">01143CB0 &gt;  55              push ebp</div><div class="line">01143CB1    8BEC            mov ebp,esp</div><div class="line">01143CB3    81EC E0000000   sub esp,0xE0</div><div class="line">01143CB9    53              push ebx</div><div class="line">01143CBA    56              push esi</div><div class="line">01143CBB    57              push edi</div><div class="line">01143CBC    8DBD 20FFFFFF   lea edi,dword ptr ss:[ebp-0xE0]</div><div class="line">01143CC2    B9 38000000     mov ecx,0x38</div><div class="line">01143CC7    B8 CCCCCCCC     mov eax,0xCCCCCCCC</div><div class="line">01143CCC    F3:AB           rep stos dword ptr es:[edi]</div><div class="line">01143CCE    A1 0C801401     mov eax,dword ptr ds:[__security_cookie]</div><div class="line">01143CD3    33C5            xor eax,ebp</div><div class="line">01143CD5    8945 FC         mov dword ptr ss:[ebp-0x4],eax</div><div class="line">01143CD8    C745 F4 0000000&gt;mov dword ptr ss:[ebp-0xC],0x0 //初始化指针</div><div class="line">01143CDF    A1 A8581401     mov eax,dword ptr ds:[0x11458A8]</div><div class="line">01143CE4    8945 E4         mov dword ptr ss:[ebp-0x1C],eax</div><div class="line">01143CE7    66:8B0D AC58140&gt;mov cx,word ptr ds:[0x11458AC]</div><div class="line">01143CEE    66:894D E8      mov word ptr ss:[ebp-0x18],cx //初始化字符串数组</div><div class="line">01143CF2    8D45 E4         lea eax,dword ptr ss:[ebp-0x1C] //取数组首地址</div><div class="line">01143CF5    8945 F4         mov dword ptr ss:[ebp-0xC],eax //把地址给指针</div><div class="line">01143CF8    8B45 F4         mov eax,dword ptr ss:[ebp-0xC]</div><div class="line">01143CFB    0FBE08          movsx ecx,byte ptr ds:[eax] //取内容给ecx</div><div class="line">01143CFE    8BF4            mov esi,esp</div><div class="line">01143D00    51              push ecx</div><div class="line">01143D01    68 B0581401     push TestCode.011458B0                   ; ASCII &quot;%c\n&quot;</div><div class="line">01143D06    FF15 14911401   call dword ptr ds:[&lt;&amp;MSVCR120D.printf&gt;]  ; MSVCR120.printf //调用printf</div><div class="line">01143D0C    83C4 08         add esp,0x8 //堆栈平衡</div><div class="line">01143D0F    3BF4            cmp esi,esp</div><div class="line">01143D11    E8 C5D4FFFF     call TestCode.011411DB</div><div class="line">01143D16    B8 01000000     mov eax,0x1 //eax == 1</div><div class="line">01143D1B    6BC8 00         imul ecx,eax,0x0 //计算下标</div><div class="line">01143D1E    0FBE540D E4     movsx edx,byte ptr ss:[ebp+ecx-0x1C]//通过下标访问数组</div><div class="line">01143D23    8BF4            mov esi,esp</div><div class="line">01143D25    52              push edx</div><div class="line">01143D26    68 B0581401     push TestCode.011458B0                   ; ASCII &quot;%c\n&quot;</div><div class="line">01143D2B    FF15 14911401   call dword ptr ds:[&lt;&amp;MSVCR120D.printf&gt;]  ; MSVCR120.printf //调用printf</div><div class="line">01143D31    83C4 08         add esp,0x8 //堆栈平衡</div><div class="line">01143D34    3BF4            cmp esi,esp</div><div class="line">01143D36    E8 A0D4FFFF     call TestCode.011411DB</div><div class="line">01143D3B    33C0            xor eax,eax</div><div class="line">01143D3D    52              push edx</div><div class="line">01143D3E    8BCD            mov ecx,ebp</div><div class="line">01143D40    50              push eax</div><div class="line">01143D41    8D15 6C3D1401   lea edx,dword ptr ds:[0x1143D6C]</div><div class="line">01143D47    E8 80D4FFFF     call TestCode.011411CC</div><div class="line">01143D4C    58              pop eax</div><div class="line">01143D4D    5A              pop edx</div><div class="line">01143D4E    5F              pop edi</div><div class="line">01143D4F    5E              pop esi</div><div class="line">01143D50    5B              pop ebx</div><div class="line">01143D51    8B4D FC         mov ecx,dword ptr ss:[ebp-0x4]</div><div class="line">01143D54    33CD            xor ecx,ebp</div><div class="line">01143D56    E8 C3D2FFFF     call TestCode.0114101E</div><div class="line">01143D5B    81C4 E0000000   add esp,0xE0</div><div class="line">01143D61    3BEC            cmp ebp,esp</div><div class="line">01143D63    E8 73D4FFFF     call TestCode.011411DB</div><div class="line">01143D68    8BE5            mov esp,ebp</div><div class="line">01143D6A    5D              pop ebp</div><div class="line">01143D6B    C3              retn</div></pre></td></tr></table></figure>
<p>书上说指针和下标寻址有着很明显的区别，指针需要进行两次寻址，而下标只需要一次，所以下标寻址的效率比较高，虽然使用指针效率低，但是更为灵活，可以改变指针变量中的地址来访问其他内存，而数组下标在不越界的情况下是无法访问到数组以外的数据的。<br>数组下标寻址公式：设首地址为aryAddr，数组元素的类型为type，元素个数为M个，下标为N<br>type Ary[M];<br>&amp;Ary[n] == (type <em>)((int)aryAddr + sizeof(type)</em>n) </p>
<h3 id="下标值为整形常量"><a href="#下标值为整形常量" class="headerlink" title="下标值为整形常量"></a>下标值为整形常量</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">C代码：</div><div class="line">int _tmain(int argc, _TCHAR* argv[])</div><div class="line">&#123;</div><div class="line">    int nArr[5] = &#123; 1, 2, 3, 4, 5 &#125;;</div><div class="line">    printf(&quot;%d\n&quot;, nArr[0]);</div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">对应反汇编Debug：</div><div class="line">00043CD8    C745 E4 0100000&gt;mov dword ptr ss:[ebp-0x1C],0x1</div><div class="line">00043CDF    C745 E8 0200000&gt;mov dword ptr ss:[ebp-0x18],0x2</div><div class="line">00043CE6    C745 EC 0300000&gt;mov dword ptr ss:[ebp-0x14],0x3</div><div class="line">00043CED    C745 F0 0400000&gt;mov dword ptr ss:[ebp-0x10],0x4</div><div class="line">00043CF4    C745 F4 0500000&gt;mov dword ptr ss:[ebp-0xC],0x5 //数组初始化</div><div class="line">00043CFB    B8 04000000     mov eax,0x4 </div><div class="line">00043D00    D1E0            shl eax,1 //计算下标</div><div class="line">00043D02    8BF4            mov esi,esp</div><div class="line">00043D04    8B4C05 E4       mov ecx,dword ptr ss:[ebp+eax-0x1C] //取数组对应下标内容</div><div class="line">00043D08    51              push ecx</div><div class="line">00043D09    68 A8580400     push TestCode.000458A8                   ; ASCII &quot;%d\n&quot;</div><div class="line">00043D0E    FF15 14910400   call dword ptr ds:[&lt;&amp;MSVCR120D.printf&gt;]  ; MSVCR120.printf</div></pre></td></tr></table></figure>
<p>套用公式计算：<br>&amp;Ary[2] ==（int<em>）（（int）ebp-0x1C + sizeof（int）</em>2）<br>在下标值为常量的情况下，由于类型大小为已知数，编译器可以直接计算出数据所在的地址。</p>
<h3 id="下标值为为整形变量"><a href="#下标值为为整形变量" class="headerlink" title="下标值为为整形变量"></a>下标值为为整形变量</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">C代码：</div><div class="line">int _tmain(int argc, _TCHAR* argv[])</div><div class="line">&#123;</div><div class="line">    int nArr[5] = &#123; 1, 2, 3, 4, 5 &#125;;</div><div class="line">    printf(&quot;%d\n&quot;, nArr[argc]);</div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">对应反汇编Debug：</div><div class="line">00A43CD8    C745 E4 0100000&gt;mov dword ptr ss:[ebp-0x1C],0x1</div><div class="line">00A43CDF    C745 E8 0200000&gt;mov dword ptr ss:[ebp-0x18],0x2</div><div class="line">00A43CE6    C745 EC 0300000&gt;mov dword ptr ss:[ebp-0x14],0x3</div><div class="line">00A43CED    C745 F0 0400000&gt;mov dword ptr ss:[ebp-0x10],0x4</div><div class="line">00A43CF4    C745 F4 0500000&gt;mov dword ptr ss:[ebp-0xC],0x5 //数组初始化</div><div class="line">00A43CFB    8BF4            mov esi,esp</div><div class="line">00A43CFD    8B45 08         mov eax,dword ptr ss:[ebp+0x8] //把参数一的值给eax</div><div class="line">00A43D00    8B4C85 E4       mov ecx,dword ptr ss:[ebp+eax*4-0x1C] //寻址计算</div><div class="line">00A43D04    51              push ecx</div><div class="line">00A43D05    68 A858A400     push TestCode.00A458A8                   ; ASCII &quot;%d\n&quot;</div><div class="line">00A43D0A    FF15 1491A400   call dword ptr ds:[&lt;&amp;MSVCR120D.printf&gt;]  ; MSVCR120.printf</div><div class="line">00A43D10    83C4 08         add esp,0x8</div></pre></td></tr></table></figure>
<h3 id="下标值为整形表达式"><a href="#下标值为整形表达式" class="headerlink" title="下标值为整形表达式"></a>下标值为整形表达式</h3><p>当下标值为表达式时，会先计算出表达式的结果，然后将其结果作为下标值。当整形表达式的计算结果可以计算出来时，编译器会选择常量折叠，将表达式用常量代替。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">C代码：</div><div class="line">int _tmain(int argc, _TCHAR* argv[])</div><div class="line">&#123;</div><div class="line">    int nArr[5] = &#123; 1, 2, 3, 4, 5 &#125;;</div><div class="line">    printf(&quot;%d\n&quot;, nArr[argc * 2]);</div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">对应反汇编Debug：</div><div class="line">00C03CD8    C745 E4 0100000&gt;mov dword ptr ss:[ebp-0x1C],0x1</div><div class="line">00C03CDF    C745 E8 0200000&gt;mov dword ptr ss:[ebp-0x18],0x2</div><div class="line">00C03CE6    C745 EC 0300000&gt;mov dword ptr ss:[ebp-0x14],0x3</div><div class="line">00C03CED    C745 F0 0400000&gt;mov dword ptr ss:[ebp-0x10],0x4</div><div class="line">00C03CF4    C745 F4 0500000&gt;mov dword ptr ss:[ebp-0xC],0x5 //数组初始化</div><div class="line">00C03CFB    8B45 08         mov eax,dword ptr ss:[ebp+0x8] //参数1给eax</div><div class="line">00C03CFE    D1E0            shl eax,1 //左移一位，相当于乘以2</div><div class="line">00C03D00    8BF4            mov esi,esp</div><div class="line">00C03D02    8B4C85 E4       mov ecx,dword ptr ss:[ebp+eax*4-0x1C]//根据下标寻址</div><div class="line">00C03D06    51              push ecx</div><div class="line">00C03D07    68 A858C000     push TestCode.00C058A8                   ; ASCII &quot;%d\n&quot;</div><div class="line">00C03D0C    FF15 1491C000   call dword ptr ds:[&lt;&amp;MSVCR120D.printf&gt;]  ; MSVCR120.printf</div><div class="line">00C03D12    83C4 08         add esp,0x8</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">以上就是数组的三种寻址方式，数组下标寻址的使用方案和指针寻址公式很相似，都是利用首地址加偏移量，数组寻址方案同样也可应用在指针寻址中。</div><div class="line"></div><div class="line">4.4数组下标越界</div><div class="line">C代码：</div><div class="line"></div><div class="line">对应反汇编Debug：</div><div class="line">00F13CD8    C745 E8 0100000&gt;mov dword ptr ss:[ebp-0x18],0x1</div><div class="line">00F13CDF    C745 EC 0200000&gt;mov dword ptr ss:[ebp-0x14],0x2</div><div class="line">00F13CE6    C745 F0 0300000&gt;mov dword ptr ss:[ebp-0x10],0x3</div><div class="line">00F13CED    C745 F4 0400000&gt;mov dword ptr ss:[ebp-0xC],0x4 //数组初始化</div><div class="line">00F13CF4    C745 DC 0500000&gt;mov dword ptr ss:[ebp-0x24],0x5 //局部变量初始化</div><div class="line">00F13CFB    B8 04000000     mov eax,0x4 </div><div class="line">00F13D00    6BC8 FF         imul ecx,eax,-0x1 //计算下标</div><div class="line">00F13D03    8BF4            mov esi,esp</div><div class="line">00F13D05    8B540D E8       mov edx,dword ptr ss:[ebp+ecx-0x18] //根据下标寻址，这里内存中的值为0xCCCCCCCC</div><div class="line">00F13D09    52              push edx</div><div class="line">00F13D0A    68 A858F100     push TestCode.00F158A8                   ; ASCII &quot;%d\n&quot;</div><div class="line">00F13D0F    FF15 1491F100   call dword ptr ds:[&lt;&amp;MSVCR120D.printf&gt;]  ; MSVCR120.printf</div><div class="line">00F13D15    83C4 08         add esp,0x8</div></pre></td></tr></table></figure>
<p>C/C++中并不会对数组的越界访问进行检查，所以在使用下标时要时刻注意不要越界访问内存中的其他数据，从而造成程序崩溃甚至更严重的后果。越界下标的使用和正常下标一样，这里不再赘述。</p>
<h2 id="多维数组"><a href="#多维数组" class="headerlink" title="多维数组"></a>多维数组</h2><p>多维数组其实在内存中也是线性存储的，在内存中排列相同，只是在程序中编译器将其做了相应的处理而已。多维数组的出现只是为了方便开发者计算偏移地址，寻址数组数据。<br>二维数组的大小计算：一维数组使用类型大小乘以下标值，得到一维数组占用内存大小。二维数组中的二维下标值为一维数组个数，因此只要将二维下标值乘以一维数组占用内存大小，即可求得。</p>
<p>二维数组偏移计算：<br>例子：int nArr[2][3]可拆分为三部分<br>数组首地址：nArr<br>一维元素类型：int[3]，此下标值记作j<br>类型：int<br>元素个数：[3]<br>一维元素个数：[2]，此下标值记作i<br>此二维数组的组成可以理解为两个以为整型数组的集合，而这两个一维数组又各自拥有三个整型数据。在地址偏移的计算过程中，先计算出首地址到一维数组间的偏移量，利用数组首地址加上偏移量，得到某一个一维数组所在地址。以此地址作为基地址，加上一维数组中数据地址偏移，寻址到二维数组中某个数据。<br>寻址公式：数组首地址 + sizeof(type[j]) <em> 二维下标值 + sizeof(type) </em> 一维下标值<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">C代码：</div><div class="line">int _tmain(int argc, _TCHAR* argv[])</div><div class="line">&#123;</div><div class="line">    int i = 0;</div><div class="line">    int j = 0;</div><div class="line">    int nArr1[4] = &#123; 1, 2, 3, 4 &#125;;</div><div class="line">    int nArr2[2][2] = &#123; &#123; 1, 2 &#125;, &#123; 3, 4 &#125; &#125;;</div><div class="line">    scanf(&quot;%d %d&quot;, &amp;i, &amp;j);</div><div class="line">    printf(&quot;nArr1 = %d\n&quot;, nArr1[i]);</div><div class="line">    printf(&quot;nArr2 = %d\n&quot;, nArr2[i][j]);</div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">对应反汇编Debug：</div><div class="line">00833CD8    C745 F4 0000000&gt;mov dword ptr ss:[ebp-0xC],0x0  //</div><div class="line">00833CDF    C745 E8 0000000&gt;mov dword ptr ss:[ebp-0x18],0x0 //局部变量初始化</div><div class="line">00833CE6    C745 D0 0100000&gt;mov dword ptr ss:[ebp-0x30],0x1</div><div class="line">00833CED    C745 D4 0200000&gt;mov dword ptr ss:[ebp-0x2C],0x2</div><div class="line">00833CF4    C745 D8 0300000&gt;mov dword ptr ss:[ebp-0x28],0x3</div><div class="line">00833CFB    C745 DC 0400000&gt;mov dword ptr ss:[ebp-0x24],0x4 //数组初始化</div><div class="line">00833D02    C745 B8 0100000&gt;mov dword ptr ss:[ebp-0x48],0x1</div><div class="line">00833D09    C745 BC 0200000&gt;mov dword ptr ss:[ebp-0x44],0x2</div><div class="line">00833D10    C745 C0 0300000&gt;mov dword ptr ss:[ebp-0x40],0x3</div><div class="line">00833D17    C745 C4 0400000&gt;mov dword ptr ss:[ebp-0x3C],0x4 //数组初始化</div><div class="line">00833D1E    8BF4            mov esi,esp</div><div class="line">00833D20    8D45 E8         lea eax,dword ptr ss:[ebp-0x18]</div><div class="line">00833D23    50              push eax</div><div class="line">00833D24    8D4D F4         lea ecx,dword ptr ss:[ebp-0xC]</div><div class="line">00833D27    51              push ecx</div><div class="line">00833D28    68 A8588300     push TestCode.008358A8                   ; ASCII &quot;%d %d&quot;</div><div class="line">00833D2D    FF15 3C918300   call dword ptr ds:[&lt;&amp;MSVCR120D.scanf&gt;]   ; MSVCR120.scanf</div><div class="line">00833D33    83C4 0C         add esp,0xC</div><div class="line">00833D36    3BF4            cmp esi,esp</div><div class="line">00833D38    E8 9ED4FFFF     call TestCode.008311DB</div><div class="line">00833D3D    8BF4            mov esi,esp</div><div class="line">00833D3F    8B45 F4         mov eax,dword ptr ss:[ebp-0xC] //取i的值</div><div class="line">00833D42    8B4C85 D0       mov ecx,dword ptr ss:[ebp+eax*4-0x30] //根据下标寻址</div><div class="line">00833D46    51              push ecx</div><div class="line">00833D47    68 18598300     push TestCode.00835918                   ; ASCII &quot;nArr1 = %d\n&quot;</div><div class="line">00833D4C    FF15 14918300   call dword ptr ds:[&lt;&amp;MSVCR120D.printf&gt;]  ; MSVCR120.printf</div><div class="line">00833D52    83C4 08         add esp,0x8</div><div class="line">00833D55    3BF4            cmp esi,esp</div><div class="line">00833D57    E8 7FD4FFFF     call TestCode.008311DB</div><div class="line">00833D5C    8B45 F4         mov eax,dword ptr ss:[ebp-0xC] //取i的值</div><div class="line">00833D5F    8D4CC5 B8       lea ecx,dword ptr ss:[ebp+eax*8-0x48]//8为每一个一维数组的大小，取第i个一维数组的首地址</div><div class="line">00833D63    8BF4            mov esi,esp</div><div class="line">00833D65    8B55 E8         mov edx,dword ptr ss:[ebp-0x18] //取j的值</div><div class="line">00833D68    8B0491          mov eax,dword ptr ds:[ecx+edx*4]//首地址+偏移进行寻址</div><div class="line">00833D6B    50              push eax</div><div class="line">00833D6C    68 E45A8300     push TestCode.00835AE4                   ; ASCII &quot;nArr2 = %d\n&quot;</div><div class="line">00833D71    FF15 14918300   call dword ptr ds:[&lt;&amp;MSVCR120D.printf&gt;]  ; MSVCR120.printf</div><div class="line">00833D77    83C4 08         add esp,0x8</div></pre></td></tr></table></figure>
<p>由此可看出一维数组和二维数组有着明显的区别，一维数组直接根据偏移量取出数组中的元素，二维数组则需要先计算第i个一维数组的首地址然后根据j偏移量来得到元素</p>
<p>使用常量寻址的二维数组<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">C代码：</div><div class="line">int _tmain(int argc, _TCHAR* argv[])</div><div class="line">&#123;</div><div class="line">    int i = 0;</div><div class="line">    </div><div class="line">    int nArr2[2][2] = &#123; &#123; 1, 2 &#125;, &#123; 3, 4 &#125; &#125;;</div><div class="line">    scanf(&quot;%d&quot;, &amp;i);</div><div class="line">    printf(&quot;nArr2 = %d\n&quot;, nArr2[1][i]);</div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line">对应反汇编Debug：</div><div class="line">000F3CD8    C745 F4 0000000&gt;mov dword ptr ss:[ebp-0xC],0x0 //局部变量初始化</div><div class="line">000F3CDF    C745 DC 0100000&gt;mov dword ptr ss:[ebp-0x24],0x1</div><div class="line">000F3CE6    C745 E0 0200000&gt;mov dword ptr ss:[ebp-0x20],0x2</div><div class="line">000F3CED    C745 E4 0300000&gt;mov dword ptr ss:[ebp-0x1C],0x3</div><div class="line">000F3CF4    C745 E8 0400000&gt;mov dword ptr ss:[ebp-0x18],0x4 //数组初始化</div><div class="line">000F3CFB    8BF4            mov esi,esp</div><div class="line">000F3CFD    8D45 F4         lea eax,dword ptr ss:[ebp-0xC]</div><div class="line">000F3D00    50              push eax</div><div class="line">000F3D01    68 A8580F00     push TestCode.000F58A8                   ; ASCII &quot;%d&quot;</div><div class="line">000F3D06    FF15 3C910F00   call dword ptr ds:[&lt;&amp;MSVCR120D.scanf&gt;]   ; MSVCR120.scanf</div><div class="line">000F3D0C    83C4 08         add esp,0x8</div><div class="line">000F3D0F    3BF4            cmp esi,esp</div><div class="line">000F3D11    E8 C5D4FFFF     call TestCode.000F11DB</div><div class="line">000F3D16    B8 08000000     mov eax,0x8 //eax == 8</div><div class="line">000F3D1B    C1E0 00         shl eax,0x0 //左移0位，相当于乘以1</div><div class="line">000F3D1E    8D4C05 DC       lea ecx,dword ptr ss:[ebp+eax-0x24] //取一维数组的首地址</div><div class="line"></div><div class="line">000F3D22    8BF4            mov esi,esp</div><div class="line">000F3D24    8B55 F4         mov edx,dword ptr ss:[ebp-0xC] //取i的值</div><div class="line">000F3D27    8B0491          mov eax,dword ptr ds:[ecx+edx*4] //根据首地址+偏移寻址</div><div class="line">000F3D2A    50              push eax</div><div class="line">000F3D2B    68 18590F00     push TestCode.000F5918                   ; ASCII &quot;nArr2 = %d\n&quot;</div><div class="line">000F3D30    FF15 14910F00   call dword ptr ds:[&lt;&amp;MSVCR120D.printf&gt;]  ; MSVCR120.printf</div><div class="line">000F3D36    83C4 08         add esp,0x8</div><div class="line"></div><div class="line">对应反汇编Release：</div><div class="line">.text:00401000 ; int __cdecl main(int argc, const char **argv, const char **envp)</div><div class="line">.text:00401000 _main           proc near               ; CODE XREF: ___tmainCRTStartup+F8p</div><div class="line">.text:00401000</div><div class="line">.text:00401000 var_18          = dword ptr -18h</div><div class="line">.text:00401000 var_14          = xmmword ptr -14h</div><div class="line">.text:00401000 var_4           = dword ptr -4</div><div class="line">.text:00401000 argc            = dword ptr  8</div><div class="line">.text:00401000 argv            = dword ptr  0Ch</div><div class="line">.text:00401000 envp            = dword ptr  10h</div><div class="line">.text:00401000</div><div class="line">.text:00401000                 push    ebp</div><div class="line">.text:00401001                 mov     ebp, esp</div><div class="line">.text:00401003                 sub     esp, 18h</div><div class="line">.text:00401006                 mov     eax, ___security_cookie</div><div class="line">.text:0040100B                 xor     eax, ebp</div><div class="line">.text:0040100D                 mov     [ebp+var_4], eax</div><div class="line">.text:00401010                 movdqa  xmm0, ds:xmmword_402130</div><div class="line">.text:00401018                 lea     eax, [ebp+var_18]</div><div class="line">.text:0040101B                 paddd   xmm0, ds:xmmword_402110</div><div class="line">.text:00401023                 paddd   xmm0, ds:xmmword_402120</div><div class="line">.text:0040102B                 push    eax</div><div class="line">.text:0040102C                 push    offset Format   ; &quot;%d&quot;</div><div class="line">.text:00401031                 mov     [ebp+var_18], 0</div><div class="line">.text:00401038                 movdqu  [ebp+var_14], xmm0</div><div class="line">.text:0040103D                 call    ds:scanf</div><div class="line">.text:00401043                 mov     eax, [ebp+var_18]</div><div class="line">.text:00401046                 push    dword ptr [ebp+eax*4+var_14+8]</div><div class="line">.text:0040104A                 push    offset aNarr2D  ; &quot;nArr2 = %d\n&quot;</div><div class="line">.text:0040104F                 call    ds:printf</div><div class="line">.text:00401055                 mov     ecx, [ebp+var_4]</div><div class="line">.text:00401058                 add     esp, 10h</div><div class="line">.text:0040105B                 xor     ecx, ebp</div><div class="line">.text:0040105D                 xor     eax, eax</div><div class="line">.text:0040105F                 call    @__security_check_cookie@4 ; __security_check_cookie(x)</div><div class="line">.text:00401064                 mov     esp, ebp</div><div class="line">.text:00401066                 pop     ebp</div><div class="line">.text:00401067                 retn</div><div class="line">.text:00401067 _main           endp</div></pre></td></tr></table></figure>
<p>这里编译器为2013，有一些变化。</p>
<p>书上的说法<br>1）使用数组首地址加二维数组下边i乘以一维数组大小，得到一维数组首地址<br>2）通过第一步获取数组首地址后，加下标j乘以类型大小，得到数据如下<br>二维数组type nArr[M][N]，使用i，j作为下标寻址<br>nArr + i <em> sizeof(type[N]) + j </em> sizeof(type)= nArr + i <em> N </em> sizeof(type) + j <em> sizeof(type) = nArr + sizeof(type) </em> (i * N + j)<br>转换后得到下标值，将二维数组的寻址过程转换为一维数组，节省一次寻址计算。</p>
<p>三围数组下标值的转换过程也就是先把三围数组拆分为3个二维数组，然后套用二维数组下标值计算公式，得到二维数组下标值，然后乘以3得出三围数组的下标值。根据下标值的计算可以分析出数组维数，根据寻址公式中的类型长度可得出数组类型。</p>
<h2 id="指针数组"><a href="#指针数组" class="headerlink" title="指针数组"></a>指针数组</h2><p>存放指针类型数据的数组就是数组中各数据元素都是由相同类型的指针组成，称为指针数组。<br>指针数组主要用于管理同种类型的指针，一般用于处理若干字符串（如二维字符数组）的操作。<br>它和数组的区别就在于在取出数组中的元素之后还要进行一次间接寻址。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">C代码：</div><div class="line">int _tmain(int argc, _TCHAR* argv[])</div><div class="line">&#123;</div><div class="line">    char *pBuf[3] = &#123; &quot;Hello&quot;, &quot;World&quot;, &quot;!!!&quot; &#125;;</div><div class="line"></div><div class="line">    for (int i = 0; i &lt; 3; i++)</div><div class="line">    &#123;</div><div class="line">        printf(pBuf[i]);</div><div class="line">    &#125;</div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">对应反汇编Debug：</div><div class="line">00393CD5       8945 FC         mov dword ptr ss:[ebp-0x4],eax</div><div class="line">00393CD8       C745 EC A858390&gt;mov dword ptr ss:[ebp-0x14],TestCode.003&gt;; ASCII &quot;Hello&quot;</div><div class="line">00393CDF       C745 F0 1859390&gt;mov dword ptr ss:[ebp-0x10],TestCode.003&gt;; ASCII &quot;World&quot;</div><div class="line">00393CE6       C745 F4 B058390&gt;mov dword ptr ss:[ebp-0xC],TestCode.0039&gt;; ASCII &quot;!!!&quot; //字符串指针数组初始化</div><div class="line">00393CED       C745 E0 0000000&gt;mov dword ptr ss:[ebp-0x20],0x0</div><div class="line">00393CF4       EB 09           jmp short TestCode.00393CFF</div><div class="line">00393CF6       8B45 E0         mov eax,dword ptr ss:[ebp-0x20]</div><div class="line">00393CF9       83C0 01         add eax,0x1</div><div class="line">00393CFC       8945 E0         mov dword ptr ss:[ebp-0x20],eax</div><div class="line">00393CFF       837D E0 03      cmp dword ptr ss:[ebp-0x20],0x3</div><div class="line">00393D03       7D 1C           jge short TestCode.00393D21</div><div class="line">00393D05       8BF4            mov esi,esp</div><div class="line">00393D07       8B45 E0         mov eax,dword ptr ss:[ebp-0x20]//把当前i的值给eax</div><div class="line">00393D0A       8B4C85 EC       mov ecx,dword ptr ss:[ebp+eax*4-0x14]//根据下标寻址</div><div class="line">00393D0E       51              push ecx</div><div class="line">00393D0F       FF15 14913900   call dword ptr ds:[&lt;&amp;MSVCR120D.printf&gt;]  ; MSVCR120.printf</div><div class="line">00393D15       83C4 04         add esp,0x4</div><div class="line">指针数组和二维字符数组有着很明显的区别，若是在初始化阶段，二维字符数组是将每个字符数据赋值，而指针数组仅仅是将字符串的首地址存入数组中。</div></pre></td></tr></table></figure>
<p>二维字符数组初始化<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">00873CD8       C745 80 A858870&gt;mov dword ptr ss:[ebp-0x80],TestCode.008&gt;; ASCII &quot;Hello&quot;</div><div class="line">00873CDF       33C0            xor eax,eax</div><div class="line">00873CE1       8945 84         mov dword ptr ss:[ebp-0x7C],eax</div><div class="line">00873CE4       8945 88         mov dword ptr ss:[ebp-0x78],eax</div><div class="line">00873CE7       8945 8C         mov dword ptr ss:[ebp-0x74],eax</div><div class="line">00873CEA       8945 90         mov dword ptr ss:[ebp-0x70],eax</div><div class="line">00873CED       8945 94         mov dword ptr ss:[ebp-0x6C],eax</div><div class="line">00873CF0       8945 98         mov dword ptr ss:[ebp-0x68],eax</div><div class="line">00873CF3       8945 9C         mov dword ptr ss:[ebp-0x64],eax</div><div class="line">00873CF6       8945 A0         mov dword ptr ss:[ebp-0x60],eax</div><div class="line">00873CF9       8945 A4         mov dword ptr ss:[ebp-0x5C],eax</div><div class="line">00873CFC       C745 A8 1859870&gt;mov dword ptr ss:[ebp-0x58],TestCode.008&gt;; ASCII &quot;World&quot;</div><div class="line">00873D03       33C0            xor eax,eax</div><div class="line">00873D05       8945 AC         mov dword ptr ss:[ebp-0x54],eax</div><div class="line">00873D08       8945 B0         mov dword ptr ss:[ebp-0x50],eax</div><div class="line">00873D0B       8945 B4         mov dword ptr ss:[ebp-0x4C],eax</div><div class="line">00873D0E       8945 B8         mov dword ptr ss:[ebp-0x48],eax</div><div class="line">00873D11       8945 BC         mov dword ptr ss:[ebp-0x44],eax</div><div class="line">00873D14       8945 C0         mov dword ptr ss:[ebp-0x40],eax</div><div class="line">00873D17       8945 C4         mov dword ptr ss:[ebp-0x3C],eax</div><div class="line">00873D1A       8945 C8         mov dword ptr ss:[ebp-0x38],eax</div><div class="line">00873D1D       8945 CC         mov dword ptr ss:[ebp-0x34],eax</div><div class="line">00873D20       C745 D0 B058870&gt;mov dword ptr ss:[ebp-0x30],TestCode.008&gt;; ASCII &quot;!!!&quot;</div><div class="line">00873D27       33C0            xor eax,eax</div><div class="line">00873D29       8945 D4         mov dword ptr ss:[ebp-0x2C],eax</div><div class="line">00873D2C       8945 D8         mov dword ptr ss:[ebp-0x28],eax</div><div class="line">00873D2F       8945 DC         mov dword ptr ss:[ebp-0x24],eax</div><div class="line">00873D32       8945 E0         mov dword ptr ss:[ebp-0x20],eax</div><div class="line">00873D35       8945 E4         mov dword ptr ss:[ebp-0x1C],eax</div><div class="line">00873D38       8945 E8         mov dword ptr ss:[ebp-0x18],eax</div><div class="line">00873D3B       8945 EC         mov dword ptr ss:[ebp-0x14],eax</div><div class="line">00873D3E       8945 F0         mov dword ptr ss:[ebp-0x10],eax</div><div class="line">00873D41       8945 F4         mov dword ptr ss:[ebp-0xC],eax</div><div class="line">00873D44       C785 74FFFFFF 0&gt;mov dword ptr ss:[ebp-0x8C],0x0</div></pre></td></tr></table></figure></p>
<h2 id="指向数组的指针变量"><a href="#指向数组的指针变量" class="headerlink" title="指向数组的指针变量"></a>指向数组的指针变量</h2><p>当指针变量保存的数据为数组的首地址，且将此地址解释为数组时，此指针变量被称为数组指针。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">C代码：</div><div class="line">int _tmain(int argc, _TCHAR* argv[])</div><div class="line">&#123;</div><div class="line">    char Buf[3][10] = &#123; &#123; &quot;Hello&quot; &#125;, &#123; &quot;World&quot; &#125;, &#123; &quot;!!!&quot; &#125; &#125;;</div><div class="line">    char(*pBuf)[10] = Buf;</div><div class="line">    for (int i = 0; i &lt; 3; i++)</div><div class="line">    &#123;</div><div class="line">        printf(*pBuf);</div><div class="line">        pBuf++;</div><div class="line">    &#125;</div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">对应反汇编Debug：</div><div class="line">01293CD5       8945 FC         mov dword ptr ss:[ebp-0x4],eax</div><div class="line">01293CD8       A1 A8582901     mov eax,dword ptr ds:[0x12958A8]</div><div class="line">01293CDD       8945 D8         mov dword ptr ss:[ebp-0x28],eax</div><div class="line">01293CE0       66:8B0D AC58290&gt;mov cx,word ptr ds:[0x12958AC]</div><div class="line">01293CE7       66:894D DC      mov word ptr ss:[ebp-0x24],cx</div><div class="line">01293CEB       33C0            xor eax,eax</div><div class="line">01293CED       8945 DE         mov dword ptr ss:[ebp-0x22],eax</div><div class="line">01293CF0       A1 18592901     mov eax,dword ptr ds:[0x1295918]</div><div class="line">01293CF5       8945 E2         mov dword ptr ss:[ebp-0x1E],eax</div><div class="line">01293CF8       66:8B0D 1C59290&gt;mov cx,word ptr ds:[0x129591C]</div><div class="line">01293CFF       66:894D E6      mov word ptr ss:[ebp-0x1A],cx</div><div class="line">01293D03       33C0            xor eax,eax</div><div class="line">01293D05       8945 E8         mov dword ptr ss:[ebp-0x18],eax</div><div class="line">01293D08       A1 B0582901     mov eax,dword ptr ds:[0x12958B0]</div><div class="line">01293D0D       8945 EC         mov dword ptr ss:[ebp-0x14],eax //以上都是二维字符数组初始化操作</div><div class="line">01293D10       33C0            xor eax,eax</div><div class="line">01293D12       8945 F0         mov dword ptr ss:[ebp-0x10],eax</div><div class="line">01293D15       66:8945 F4      mov word ptr ss:[ebp-0xC],ax</div><div class="line">01293D19       8D45 D8         lea eax,dword ptr ss:[ebp-0x28] //取数组首地址</div><div class="line">01293D1C       8945 CC         mov dword ptr ss:[ebp-0x34],eax //把首地址给ebp-0x34</div><div class="line">01293D1F       C745 C0 0000000&gt;mov dword ptr ss:[ebp-0x40],0x0 //初始化变量i</div><div class="line">01293D26       EB 09           jmp short TestCode.01293D31</div><div class="line">01293D28       8B45 C0         mov eax,dword ptr ss:[ebp-0x40]</div><div class="line">01293D2B       83C0 01         add eax,0x1</div><div class="line">01293D2E       8945 C0         mov dword ptr ss:[ebp-0x40],eax</div><div class="line">01293D31       837D C0 03      cmp dword ptr ss:[ebp-0x40],0x3</div><div class="line">01293D35       7D 21           jge short TestCode.01293D58</div><div class="line">01293D37       8BF4            mov esi,esp</div><div class="line">01293D39       8B45 CC         mov eax,dword ptr ss:[ebp-0x34] //字符串首地址给eax</div><div class="line">01293D3C       50              push eax</div><div class="line">01293D3D       FF15 14912901   call dword ptr ds:[&lt;&amp;MSVCR120D.printf&gt;]  ; MSVCR120.printf</div><div class="line">01293D43       83C4 04         add esp,0x4</div><div class="line">01293D46       3BF4            cmp esi,esp</div><div class="line">01293D48       E8 8ED4FFFF     call TestCode.012911DB</div><div class="line">01293D4D       8B45 CC         mov eax,dword ptr ss:[ebp-0x34] //首地址给eax</div><div class="line">01293D50       83C0 0A         add eax,0xA //eax += 0xa，因为pBuf的指针类型是长度为10的字符数组</div><div class="line">01293D53       8945 CC         mov dword ptr ss:[ebp-0x34],eax</div></pre></td></tr></table></figure>
<p>指针加法公式：指针变量+=数值 &lt;–&gt;指针变量地址数据 += （sizeof（指针类型）+ 数值）</p>
<h2 id="函数指针"><a href="#函数指针" class="headerlink" title="函数指针"></a>函数指针</h2><p>用于保存函数首地址的指针变量被称为函数指针。<br>定义：返回值类型（调用约定 *函数指针变量名称）（参数信息）</p>
<h3 id="无参函数指针"><a href="#无参函数指针" class="headerlink" title="无参函数指针"></a>无参函数指针</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">C代码：</div><div class="line">void __cdecl Show()</div><div class="line">&#123;</div><div class="line">    printf(&quot;Show\n&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">int _tmain(int argc, _TCHAR* argv[])</div><div class="line">&#123;</div><div class="line">    void(__cdecl *pFun)() = Show;</div><div class="line">    pFun();</div><div class="line">    Show();</div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">对应反汇编Debug：</div><div class="line"></div><div class="line">00401790 Tes&gt;  55              push ebp</div><div class="line">00401791       8BEC            mov ebp,esp</div><div class="line">00401793       81EC CC000000   sub esp,0xCC</div><div class="line">00401799       53              push ebx</div><div class="line">0040179A       56              push esi</div><div class="line">0040179B       57              push edi</div><div class="line">0040179C       8DBD 34FFFFFF   lea edi,dword ptr ss:[ebp-0xCC]</div><div class="line">004017A2       B9 33000000     mov ecx,0x33</div><div class="line">004017A7       B8 CCCCCCCC     mov eax,0xCCCCCCCC</div><div class="line">004017AC       F3:AB           rep stos dword ptr es:[edi]</div><div class="line">004017AE       C745 F8 5812400&gt;mov dword ptr ss:[ebp-0x8],TestCode.00401258 //初始化函数指针，函数名就为函数首地址</div><div class="line">004017B5       8BF4            mov esi,esp</div><div class="line">004017B7       FF55 F8         call dword ptr ss:[ebp-0x8] //间接调用函数</div><div class="line">004017BA       3BF4            cmp esi,esp</div><div class="line">004017BC       E8 1AFAFFFF     call TestCode.004011DB </div><div class="line">004017C1       E8 92FAFFFF     call TestCode.00401258 //直接调用函数</div><div class="line">004017C6       33C0            xor eax,eax</div><div class="line">004017C8       5F              pop edi</div><div class="line">004017C9       5E              pop esi</div><div class="line">004017CA       5B              pop ebx</div><div class="line">004017CB       81C4 CC000000   add esp,0xCC</div><div class="line">004017D1       3BEC            cmp ebp,esp</div><div class="line">004017D3       E8 03FAFFFF     call TestCode.004011DB</div><div class="line">004017D8       8BE5            mov esp,ebp</div><div class="line">004017DA       5D              pop ebp</div><div class="line">004017DB       C3              retn</div></pre></td></tr></table></figure>
<h3 id="带参函数指针"><a href="#带参函数指针" class="headerlink" title="带参函数指针"></a>带参函数指针</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">C代码：</div><div class="line">int __stdcall Show(int n)</div><div class="line">&#123;</div><div class="line">    printf(&quot;Show:%d\n&quot;,n);</div><div class="line">    return n;</div><div class="line">&#125;</div><div class="line"></div><div class="line">int _tmain(int argc, _TCHAR* argv[])</div><div class="line">&#123;</div><div class="line">    int(__stdcall *pFun)(int) = Show;</div><div class="line">    pFun(1);</div><div class="line">    Show(1);</div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">对应反汇编Debug：</div><div class="line">010B17AE       C745 F8 5D120B0&gt;mov dword ptr ss:[ebp-0x8],TestCode.010B125D //初始化函数指针</div><div class="line">010B17B5       8BF4            mov esi,esp</div><div class="line">010B17B7       6A 01           push 0x1 //压入参数</div><div class="line">010B17B9       FF55 F8         call dword ptr ss:[ebp-0x8] //间接调用</div><div class="line">010B17BC       3BF4            cmp esi,esp</div><div class="line">010B17BE       E8 18FAFFFF     call TestCode.010B11DB</div><div class="line">010B17C3       6A 01           push 0x1</div><div class="line">010B17C5       E8 93FAFFFF     call TestCode.010B125D</div></pre></td></tr></table></figure>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/逆向/" rel="tag">#逆向</a>
          
            <a href="/tags/反汇编/" rel="tag">#反汇编</a>
          
            <a href="/tags/C/" rel="tag">#C++</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/11/23/逆向笔记（四）/" rel="next" title="逆向笔记（四）">
                <i class="fa fa-chevron-left"></i> 逆向笔记（四）
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/11/26/逆向笔记（六）/" rel="prev" title="逆向笔记（六）">
                逆向笔记（六） <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/11/23/逆向笔记（五）/"
           data-title="逆向笔记（五）" data-url="http://blog.injectxx.com/2016/11/23/逆向笔记（五）/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="岁月。" />
          <p class="site-author-name" itemprop="name">岁月。</p>
          <p class="site-description motion-element" itemprop="description">志之所向，金石为开，谁能御之？</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">26</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">23</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/Kernel32Sun" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://weibo.com" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="mailto:s.allure.love@gmail.com" target="_blank" title="Email">
                  
                    <i class="fa fa-fw fa-envelope"></i>
                  
                  Email
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-block">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              小伙伴儿
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.injectxx.com/" title="岁月's Blog" target="_blank">岁月's Blog</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.wangzhixian.org/" title="wnagzihxain’s Blog" target="_blank">wnagzihxain’s Blog</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#数组在函数内"><span class="nav-number">1.</span> <span class="nav-text">数组在函数内</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数组作为参数"><span class="nav-number">2.</span> <span class="nav-text">数组作为参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Strcpy分析"><span class="nav-number">3.</span> <span class="nav-text">Strcpy分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#局部数组作为返回值"><span class="nav-number">4.</span> <span class="nav-text">局部数组作为返回值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#下标寻址和指针寻址"><span class="nav-number">5.</span> <span class="nav-text">下标寻址和指针寻址</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#下标值为整形常量"><span class="nav-number">5.1.</span> <span class="nav-text">下标值为整形常量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#下标值为为整形变量"><span class="nav-number">5.2.</span> <span class="nav-text">下标值为为整形变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#下标值为整形表达式"><span class="nav-number">5.3.</span> <span class="nav-text">下标值为整形表达式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#多维数组"><span class="nav-number">6.</span> <span class="nav-text">多维数组</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#指针数组"><span class="nav-number">7.</span> <span class="nav-text">指针数组</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#指向数组的指针变量"><span class="nav-number">8.</span> <span class="nav-text">指向数组的指针变量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#函数指针"><span class="nav-number">9.</span> <span class="nav-text">函数指针</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#无参函数指针"><span class="nav-number">9.1.</span> <span class="nav-text">无参函数指针</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#带参函数指针"><span class="nav-number">9.2.</span> <span class="nav-text">带参函数指针</span></a></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>


<div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">岁月。</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
  

  
    <span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span>
  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"kernel32sun"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  

  

  

  
<script type="text/javascript" async src="//push.zhanzhang.baidu.com/push.js">
</script>


</body>
</html>
